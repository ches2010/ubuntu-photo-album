<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›¸å†Œè®¾ç½®</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ç›¸å†Œè®¾ç½®</h1>
            <a href="/" class="settings-link">ğŸ  è¿”å›ç›¸å†Œ</a>
        </div>
        <div class="settings-form">
            <label for="imageFolder">å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„:</label>
            <input type="text" id="imageFolder" name="imageFolder" value="">
            <button id="saveSettings">ä¿å­˜è®¾ç½®</button>
            <div id="message" class="message"></div>
        </div>
    </div>

    <script>
        const imageFolderInput = document.getElementById('imageFolder');
        const saveButton = document.getElementById('saveSettings');
        const messageDiv = document.getElementById('message');

        // API ç«¯ç‚¹
        const API_BASE_URL = '';
        const CONFIG_API_URL = `${API_BASE_URL}/api/config`;

        // é¡µé¢åŠ è½½æ—¶è·å–å½“å‰é…ç½®
        async function loadSettings() {
            try {
                const response = await fetch(CONFIG_API_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const configData = await response.json();
                if (configData.settings && configData.settings.image_folder) {
                    imageFolderInput.value = configData.settings.image_folder;
                }
            } catch (error) {
                console.error("åŠ è½½è®¾ç½®å¤±è´¥:", error);
                showMessage("åŠ è½½è®¾ç½®å¤±è´¥: " + error.message, "error");
            }
        }

        // ä¿å­˜è®¾ç½®
        async function saveSettings() {
            const newImagePath = imageFolderInput.value.trim();
            if (!newImagePath) {
                showMessage("è¯·è¾“å…¥å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„ã€‚", "error");
                return;
            }

            const payload = {
                settings: {
                    image_folder: newImagePath
                }
            };

            try {
                const response = await fetch(CONFIG_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (response.ok) {
                    showMessage(data.message || "è®¾ç½®å·²ä¿å­˜ã€‚", "success");
                    // å¯é€‰ï¼šè‡ªåŠ¨åˆ·æ–°ç›¸å†Œé¡µé¢æˆ–æç¤ºç”¨æˆ·åˆ·æ–°
                } else {
                    throw new Error(data.error || "ä¿å­˜å¤±è´¥");
                }
            } catch (error) {
                console.error("ä¿å­˜è®¾ç½®å¤±è´¥:", error);
                showMessage("ä¿å­˜è®¾ç½®å¤±è´¥: " + error.message, "error");
            }
        }

        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
            // å¯é€‰ï¼šå‡ ç§’åè‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯
            // setTimeout(() => { messageDiv.textContent = ''; messageDiv.className = 'message'; }, 5000);
        }

        saveButton.addEventListener('click', saveSettings);

        window.onload = loadSettings;
    </script>
</body>
</html>



